<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beatnik Music Studio</title>
    <link rel="stylesheet" href="music-studio.css">
</head>
<body>
    <div class="drop-overlay" id="dropOverlay">
        <div style="text-align: center;">
            <img src="beatnik-spotlogo.png" alt="Beatnik" style="width: 180px; margin-bottom: 24px;">
            <div>Drop MIDI or RMF file to load</div>
        </div>
    </div>
    <div class="container">
        <header>
            <img src="beatnik-spotlogo.png" alt="Beatnik" class="logo" id="beatnikLogo" style="cursor: pointer;">
            <h1>Music Studio</h1>
            <div class="preset-wrapper" id="presetWrapper">
                <span class="preset-link" id="presetHyperactive">Play Demo</span>
                <div class="preset-menu" id="presetMenu">
                    <div class="preset-menu-item" data-song="/content/RMF/hyperactive.rmf" data-name="Hyperactive.rmf">Hyperactive.rmf</div>
                    <div class="preset-menu-item" data-song="/content/MIDI/Other/Reflets.mid" data-name="Reflets.mid">Claude Debussy - Reflets dans l'eau.mid</div>
                    <div class="preset-menu-item" data-song="/content/MIDI/Other/Chill_Jingle.mid" data-name="Chill_Jingle.mid">Chill_Jingle.mid</div>
                    <div class="preset-menu-item" data-song="/content/MIDI/Other/flutey.mid" data-name="Flutey.mid">Flutey.mid</div>
                    <div class="preset-menu-item" data-song="/content/MIDI/Other/royal.mid" data-name="Royal.mid">Royal.mid</div>
                    <div class="preset-menu-item" data-song="/content/MIDI/Other/Shredded_Paper.mid" data-name="Shredded_Paper.mid">Shredded_Paper.mid</div>
                    <div class="preset-menu-item" data-song="/content/MIDI/Other/sogrand.mid" data-name="SoGrand.mid">SoGrand.mid</div>
                    <div class="preset-menu-item" data-song="/content/MIDI/WebTV/ClassicROM/DialingWebTV.mid" data-name="DialingWebTV.mid">DialingWebTV.mid</div>
                    <div class="preset-menu-item" data-song="/content/MIDI/WebTV/ClassicROM/Daybreak.mid" data-name="Daybreak.mid">Daybreak.mid</div>
                    <div class="preset-menu-item" data-song="/content/MIDI/WebTV/ClassicROM/world1.mid" data-name="world1.mid">world1.mid</div>
                    <div class="preset-menu-item" data-song="/content/RMF/backwaters.rmf" data-name="Backwaters.rmf">Backwaters.rmf</div>
                    <div class="preset-menu-item" data-song="/content/RMF/chopin-ballade-1.rmf" data-name="Chopin Ballade 1.rmf">Chopin Ballade 1.rmf</div>
                    <div class="preset-menu-item" data-song="/content/RMF/chopin-ballade-2.rmf" data-name="Chopin Ballade 2.rmf">Chopin Ballade 2.rmf</div>
                    <div class="preset-menu-item" data-song="/content/RMF/chopin-nocturne.rmf" data-name="Chopin Nocturne.rmf">Chopin Nocturne.rmf</div>
                    <div class="preset-menu-item" data-song="/content/RMF/cozy.rmf" data-name="Cozy.rmf">Cozy.rmf</div>
                    <div class="preset-menu-item" data-song="/content/RMF/la-barriera.rmf" data-name="La Barriera.rmf">La Barriera.rmf</div>
                    <div class="preset-menu-item" data-song="/content/RMF/personal-twilight.rmf" data-name="Personal Twilight.rmf">Personal Twilight.rmf</div>
                    <div class="preset-menu-item" data-song="/content/RMF/polyzoot.rmf" data-name="Polyzoot.rmf">Polyzoot.rmf</div>
                    <div class="preset-menu-item" data-song="/content/RMF/sociable.rmf" data-name="Sociable.rmf">Sociable.rmf</div>
                    <div class="preset-menu-item" data-song="/content/RMF/sunlane.rmf" data-name="Sunlane.rmf">Sunlane.rmf</div>
                </div>
            </div>
            <div class="drop-zone" id="dropZone" style="margin-left: auto; padding: 8px 20px;">
                <div>Drop MIDI/RMF or click to load</div>
            </div>
            <input type="file" id="fileInput" accept=".rmf,.mid,.midi,.kar,.smf">
        </header>

        <div class="panel">
            <h2>Soundbank Selection</h2>
            <div class="dual-container">
                <div class="channel-panel left">
                    <div class="channel-label">Soundbank A</div>
                    <select id="soundbankLeft">
                        <option value="">-- Select Soundbank --</option>
                        <option value="/content/PatchBanks/HSB/patchesp.hsb" selected>Beatnik Pro v3.0.0</option>
                        <option value="/content/PatchBanks/HSB/patches-wtv-uncompressed.hsb">WebTV Plus Uncompressed</option>
                        <option value="/content/PatchBanks/HSB/minibae-wtv.hsb">WebTV Classic</option>
                        <option value="/content/PatchBanks/HSB/minibae-wtv_5-17-96.hsb">WebTV Alpha May 1996</option>
                        <option value="/content/PatchBanks/HSB/big_synth-beos.hsb">BeOS Big Synth</option>
                        <option value="/content/PatchBanks/HSB/danger-hiptop.hsb">T-Mobile Sidekick</option>
                        <option value="/content/PatchBanks/HSB/minibae-nokia-3510.hsb">Nokia 3510</option>
                        <option value="/content/PatchBanks/HSB/minibae-nokia-5140i.hsb">Nokia 5140i</option>
                        <option value="/content/PatchBanks/HSB/minibae-nokia-7650.hsb">Nokia 7650</option>
                        <option value="/content/PatchBanks/HSB/minibae-nokia-ngage.hsb">Nokia N-Gage</option>
                        <option value="/content/PatchBanks/HSB/sony-ericsson-p800.hsb">Sony Ericsson P800</option>
                        <option value="/content/PatchBanks/HSB/sony-ericsson-p900.hsb">Sony Ericsson P900</option>
                        <option value="/content/PatchBanks/HSB/spmidi_meycro2.hsb">SP-MIDI Meycro2</option>
                        <option value="/content/PatchBanks/HSB/spmidi_nano3.hsb">SP-MIDI Nano3</option>
                    </select>
                    <div class="volume-row">
                        <label>Volume</label>
                        <input type="range" id="volumeLeft" min="0" max="100" value="100">
                        <span class="value" id="volumeLeftValue">100%</span>
                    </div>
                    <div class="stereo-controls">
                        <div class="stereo-row">
                            <label>Pan</label>
                            <input type="range" class="pan-slider" id="panLeft" min="-100" max="100" value="0">
                            <span class="value" id="panLeftValue">C</span>
                        </div>
                        <div class="stereo-row">
                            <label>Width</label>
                            <input type="range" id="widthLeft" min="0" max="200" value="100">
                            <span class="value" id="widthLeftValue">100%</span>
                        </div>
                    </div>
                    <div class="status" id="statusLeft">Not initialized</div>
                    <div class="mixer-panel" id="mixerLeft">
                        <div class="mixer-header">
                            <h3>MIDI Channels</h3>
                            <div class="mixer-actions">
                                <button onclick="resetChannelsLeft()">Reset</button>
                                <button onclick="muteAllLeft()">Mute All</button>
                            </div>
                        </div>
                        <div class="channel-grid-wrapper">
                            <div class="channel-grid" id="channelGridLeft"></div>
                            <img src="tell-me-about.gif" alt="" class="mascot" id="mascotGif" title="Tell me about your childhood...">
                        </div>
                    </div>
                    <div class="soundbank-meter">
                        <div class="soundbank-meter-label">Output Level</div>
                        <div class="soundbank-meter-bar">
                            <div class="soundbank-meter-fill" id="meterLeft" style="width: 0%"></div>
                        </div>
                    </div>
                </div>

                <div class="channel-panel right">
                    <div class="channel-label">Soundbank B</div>
                    <select id="soundbankRight">
                        <option value="">-- Select Soundbank --</option>
                        <option value="/content/PatchBanks/HSB/patchesp.hsb">Beatnik Pro v3.0.0</option>
                        <option value="/content/PatchBanks/HSB/patches-wtv-uncompressed.hsb">WebTV Plus Uncompressed</option>
                        <option value="/content/PatchBanks/HSB/minibae-wtv.hsb">WebTV Classic</option>
                        <option value="/content/PatchBanks/HSB/minibae-wtv_5-17-96.hsb">WebTV Alpha May 1996</option>
                        <option value="/content/PatchBanks/HSB/big_synth-beos.hsb">BeOS Big Synth</option>
                        <option value="/content/PatchBanks/HSB/danger-hiptop.hsb">T-Mobile Sidekick</option>
                        <option value="/content/PatchBanks/HSB/minibae-nokia-3510.hsb">Nokia 3510</option>
                        <option value="/content/PatchBanks/HSB/minibae-nokia-5140i.hsb">Nokia 5140i</option>
                        <option value="/content/PatchBanks/HSB/minibae-nokia-7650.hsb">Nokia 7650</option>
                        <option value="/content/PatchBanks/HSB/minibae-nokia-ngage.hsb">Nokia N-Gage</option>
                        <option value="/content/PatchBanks/HSB/SonyUIQBank_P900.hsb">Sony Ericsson P900</option>
                        <option value="/content/PatchBanks/HSB/spmidi_meycro2.hsb">SP-MIDI Meycro2</option>
                        <option value="/content/PatchBanks/HSB/spmidi_nano3.hsb">SP-MIDI Nano3</option>
                    </select>
                    <div class="volume-row">
                        <label>Volume</label>
                        <input type="range" id="volumeRight" min="0" max="100" value="100">
                        <span class="value" id="volumeRightValue">100%</span>
                    </div>
                    <div class="stereo-controls">
                        <div class="stereo-row">
                            <label>Pan</label>
                            <input type="range" class="pan-slider" id="panRight" min="-100" max="100" value="0">
                            <span class="value" id="panRightValue">C</span>
                        </div>
                        <div class="stereo-row">
                            <label>Width</label>
                            <input type="range" id="widthRight" min="0" max="200" value="100">
                            <span class="value" id="widthRightValue">100%</span>
                        </div>
                    </div>
                    <div class="status" id="statusRight">Not initialized</div>
                    <div class="mixer-panel" id="mixerRight">
                        <div class="mixer-header">
                            <h3>MIDI Channels</h3>
                            <div class="mixer-actions">
                                <button onclick="resetChannelsRight()">Reset</button>
                                <button onclick="muteAllRight()">Mute All</button>
                            </div>
                        </div>
                        <div class="channel-grid" id="channelGridRight"></div>
                    </div>
                    <div class="soundbank-meter">
                        <div class="soundbank-meter-label">Output Level</div>
                        <div class="soundbank-meter-bar">
                            <div class="soundbank-meter-fill" id="meterRight" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="panel" id="playerPanel" style="display: none;">
            <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 6px;">
                <h2 style="margin-bottom: 0;">Now Playing:</h2>
                <div class="now-playing" id="nowPlaying" style="padding: 0; flex: 1; text-align: left;">-</div>
                <div class="transport" style="padding: 0;">
                    <button class="transport-btn" id="stopBtn" title="Stop">STOP</button>
                    <button class="transport-btn play" id="playPauseBtn" title="Play/Pause">PLAY</button>
                    <button class="transport-btn" id="exportBtn" title="Export WAV">EXPORT</button>
                </div>
            </div>

            <div style="display: flex; align-items: center; gap: 8px;">
                <span id="currentTime" style="font-size: 15px; color: #555; min-width: 45px;">0:00</span>
                <div class="progress-container" id="progressContainer" style="flex: 1; margin: 0;">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
                <span id="duration" style="font-size: 15px; color: #555; min-width: 45px; text-align: right;">0:00</span>
            </div>

            <div style="display: flex; gap: 10px; margin-top: 8px; flex-wrap: wrap; align-items: center;">
                <div class="button-grid" style="flex: 1; min-width: 300px;">
                    <button class="ctrl-btn" id="upThirdBtn" title="+3 semitones">+3rd</button>
                    <button class="ctrl-btn" id="downFifthBtn" title="-5 semitones">-5th</button>
                    <button class="ctrl-btn" id="upOctaveBtn" title="+12 semitones">+Oct</button>
                    <button class="ctrl-btn" id="tempoUpBtn" title="+5% tempo">Tempo+</button>
                    <button class="ctrl-btn" id="tempoDownBtn" title="-5% tempo">Tempo-</button>
                    <button class="ctrl-btn" id="resetBtn" title="Reset all">Reset</button>
                </div>
                <div class="gain-row" style="min-width: 180px;">
                    <span class="gain-label">Gain</span>
                    <input type="range" id="gainSlider" min="0" max="200" value="60">
                    <span class="gain-value" id="gainValue">60%</span>
                </div>
                <div class="reverb-control">
                    <label>Reverb</label>
                    <select id="reverbSelect">
                        <option value="0">None</option>
                        <option value="1">Closet</option>
                        <option value="2">Garage</option>
                        <option value="3">Lab</option>
                        <option value="4">Cavern</option>
                        <option value="5">Dungeon</option>
                        <option value="6" selected>Small</option>
                        <option value="7">Early</option>
                        <option value="8">Basement</option>
                        <option value="9">Hall</option>
                        <option value="10">Catacombs</option>
                    </select>
                </div>
            </div>

            <div class="export-progress" id="exportProgress" style="display: none;">
                <div class="export-status" id="exportStatus">Rendering...</div>
                <div class="progress-container">
                    <div class="progress-bar" id="exportProgressBar"></div>
                </div>
            </div>

            <div style="display: flex; gap: 15px; margin-top: 8px; align-items: center;">
                <div class="balance-slider-wrapper" style="flex: 1;">
                    <span style="font-size: 9px; color: #555;">A</span>
                    <input type="range" id="balanceSlider" min="0" max="100" value="50">
                    <span style="font-size: 9px; color: #555;">B</span>
                </div>
                <div class="master-meters" style="flex: 1; margin: 0; padding: 6px;">
                    <div class="master-meter-row" style="margin-bottom: 2px;">
                        <span class="master-ch-label">L</span>
                        <div class="master-meter-bar">
                            <div class="master-meter-fill" id="masterMeterL" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="master-meter-row">
                        <span class="master-ch-label">R</span>
                        <div class="master-meter-bar">
                            <div class="master-meter-fill" id="masterMeterR" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="instrument-picker" id="instrumentPicker">
            <div class="instrument-picker-header">
                <span class="instrument-picker-title">Channel <span id="pickerChannel">1</span> - <span id="pickerSide">A</span></span>
                <button class="instrument-picker-close" id="pickerClose">&times;</button>
            </div>
            <div class="instrument-categories" id="instrumentCategories"></div>
            <div class="instrument-list" id="instrumentList"></div>
        </div>

        <div class="powered-by">
            Powered by <a href="https://github.com/zefie/miniBAE/" target="_blank">zefie miniBAE</a> / webcd
        </div>
    </div>

    <script src="player.js"></script>
    <script src="engine.js"></script>
    <script src="music-studio.js"></script>
</body>
</html>
