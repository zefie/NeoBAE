<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>zefidi web player</title>
    <link rel="stylesheet" href="./player.css">
</head>
<body>
    <div class="player-container">
        <div class="title-bar">
            <div class="title-bar-text">zefidi web player</div>
            <div class="help-icon" id="helpIcon" title="URL Parameters Help">?</div>
        </div>
        
        <div class="content">
            <!-- MIDI Channels -->
            <div class="section">
                <div class="section-title">MIDI Channels</div>
                <div class="channels-grid" id="channelsGrid"></div>
                <div class="channel-controls">
                    <button class="btn-small" id="invertBtn">Invert</button>
                    <button class="btn-small" id="muteAllBtn">Mute All</button>
                    <button class="btn-small" id="unmuteAllBtn">Unmute All</button>
                </div>
            </div>

            <!-- Playback Controls -->
            <div class="section">
                <div class="section-title">Playback Controls</div>
                <div class="controls-row">
                    <div class="control-group">
                        <label class="control-label">Transpose:</label>
                        <div class="slider-container">
                            <input type="range" id="transposeSlider" class="slider" 
                                   min="-12" max="12" value="0" step="1">
                            <span class="slider-value" id="transposeValue">+0</span>
                            <button class="btn-reset" id="transposeReset">Reset</button>
                        </div>
                    </div>
                </div>
                <div class="controls-row">
                    <div class="control-group">
                        <label class="control-label">Tempo:</label>
                        <div class="slider-container">
                            <input type="range" id="tempoSlider" class="slider" 
                                   min="50" max="200" value="100" step="1">
                            <span class="slider-value" id="tempoValue">100%</span>
                            <button class="btn-reset" id="tempoReset">Reset</button>
                        </div>
                    </div>
                </div>
                <div class="controls-row">
                    <div class="control-group">
                        <label class="control-label">Reverb:</label>
                        <select id="reverbSelect">
                            <option value="0">No Reverb</option>
                            <option value="1">Closet</option>
                            <option value="2">Garage</option>
                            <option value="3">Acoustic Lab</option>
                            <option value="4">Cavern</option>
                            <option value="5">Dungeon</option>
                            <option value="6">Small Reflections</option>
                            <option value="7">Early Reflections</option>
                            <option value="8">Basement</option>
                            <option value="9">Banquet Hall</option>
                            <option value="10">Catacombs</option>
                        </select>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Volume:</label>
                        <div class="slider-container">
                            <input type="range" id="volumeSlider" class="slider" 
                                min="0" max="200" value="100" step="1">
                            <span class="slider-value" id="volumeValue">100%</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- File Loading -->
            <div class="section">
                <div class="section-title">File Loading</div>
                <div class="controls-row">
                    <div class="control-group">
                        <label class="control-label">Media File:</label>
                        <div class="file-load-container">
                            <input type="file" id="mediaFileInput" accept=".mid,.midi,.rmi,.rmf,.xmf,.mxmf,.wav,.mp2,.mp3" style="display: none;">
                            <button class="btn-file-load" id="loadMediaBtn">Load Media</button>
                            <span class="file-load-status" id="mediaLoadStatus">URL param or use button</span>
                        </div>
                    </div>
                    <div class="control-group">
                        <label class="control-label">Soundbank:</label>
                        <div class="file-load-container">
                            <input type="file" id="bankFileInput" accept=".sf2,.sf3,.sfo,.hsb,.dls" style="display: none;">
                            <button class="btn-file-load" id="loadBankBtn">Load Bank</button>
                            <span class="file-load-status" id="bankLoadStatus">Default or use button</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Transport & Progress -->
            <div class="section">
                <div class="section-title">Transport & Progress</div>
                <div class="transport-section">
                    <div class="transport-controls">
                        <button id="playBtn" class="btn-transport" disabled>Play</button>
                        <button id="stopBtn" class="btn-transport" disabled>Stop</button>
                        <button id="exportBtn" class="btn-transport" disabled>Export WAV</button>
                        <div class="loop-control">
                            <input type="checkbox" id="loopCheckbox" class="loop-checkbox" checked>
                            <label for="loopCheckbox" class="loop-label">BAE Loop</label>
                        </div>
                    </div>
                    <div id="exportProgress" class="export-progress">
                        <div class="export-status" id="exportStatus">Rendering audio...</div>
                        <div class="export-progress-bar">
                            <div class="export-progress-fill" id="exportProgressFill"></div>
                        </div>
                    </div>
                    <div class="progress-section">
                        <div class="time-display" id="currentTime">00:00.000</div>
                        <div class="progress-bar" id="progressBar">
                            <div class="progress-fill" id="progressFill"></div>
                        </div>
                        <div class="time-display" id="duration">00:00.000</div>
                    </div>
                    <div class="master-vu">
                        <div class="master-vu-label">Output VU</div>
                        <div class="master-vu-bars">
                            <div class="master-vu-row">
                                <span class="vu-side">L</span>
                                <div class="vu-meter master-vu-meter">
                                    <div class="vu-meter-fill" id="vu-master-left"></div>
                                </div>
                            </div>
                            <div class="master-vu-row">
                                <span class="vu-side">R</span>
                                <div class="vu-meter master-vu-meter">
                                    <div class="vu-meter-fill" id="vu-master-right"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Virtual Keyboard -->
            <div class="section virtual-keyboard-section">
                <div class="section-title">Virtual MIDI Keyboard</div>
                <div class="keyboard">
                    <div class="keyboard-controls">
                        <select class="keyboard-select" id="channelSelect">
                            <option value="0">Ch 1</option>
                        </select>
                        <input type="checkbox" id="allChannelsCheckbox" class="loop-checkbox">
                        <label for="allChannelsCheckbox" class="loop-label">All Ch.</label>
                    </div>
                    <div class="keys-container" id="keysContainer"></div>
                </div>
            </div>
        </div>

        <!-- Karaoke Display (hidden until lyrics detected) -->
        <div class="karaoke-panel" id="karaokePanel" style="display: none;">
            <div class="karaoke-line karaoke-previous" id="karaokePrevious"></div>
            <div class="karaoke-line karaoke-current" id="karaokeCurrent"></div>
        </div>

        <div class="status-bar">
            <div class="status-item">
                <span class="status-label">File:</span>
                <span id="fileStatus">-</span>
            </div>
            <div class="status-separator"></div>
            <div class="status-item">
                <span class="status-label">Bank:</span>
                <span id="bankStatus">-</span>
            </div>
            <div class="status-separator"></div>
            <div class="status-item">
                <div class="status-indicator stopped" id="statusIndicator"></div>
                <span id="statusText">Stopped</span>
            </div>
        </div>
    </div>

    <script src="./player-class.js"></script>
    <script src="./engine.js"></script>
    <script src="./player.js"></script>
</body>
</html>